{% extends "base.html" %}

{% block css %}
{% endblock %}

{% block body %}

<!-- changes made -->

<div class="container">
  {% for s in story %}
  <div class="altogether">
    <div class="row">
      <div class="span3">
        <p class="pubdate">{{s.date}}, by <a class="linkme" href="/profile/{{s.user.username}}">{{s.user.username}}</a></p>
      </div>
      <p class="pub"><a class="linkme">follow</a></p>
    </div>
    <div class="nextObjectW">
      <div class="containme">
        {% for l in links %}
          {% if l.story.id == s.id %}
            {% if l.path != "" %}
              <img class="photo" id="photo{{l.links}}" src="/media/{{l.path}}">
            {% else %}
              <img class="photo" style="display:none;" id="photo{{l.links}}" src="/media/{{l.path}}">
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
      <div class="textpart" id="linkme{{s.id}}">
      <center style="margin-bottom:20px;">
      {% for w, i, x in snippet %}
        {% if x == s.id %}
          {% if w.links == None %}
            <p id="cool{{i}}{{s.id}}" class="format">{{w}}</p>
          {% else %}
            <p id="awesome{{i}}{{s.id}}" class="formats">{{w.links}}</p>
          {% endif %}
        {% endif %}
      {% endfor %}
      </center>
      {% for word, index, y in snippet_large %}
        {% if y == s.id %}
          {% if word.links == None %}
            <p id="cooler{{index}}{{s.id}}" class="format">{{word}}</p>
          {% else %}
            <p id="awesomer{{index}}{{s.id}}" class="formats">{{word.links}}</p>
          {% endif %}
        {% endif %}
      {% endfor %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- modal -->
<div id="myModal" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" id="close_x">Ã—</button>
    <p style="font-size:16px;margin-bottom:0;">Tag this token with an image!</p>
  </div>
  <div class="modal-body">
    <form method="POST" enctype="multipart/form-data" style="margin-bottom:10px;" id="form_id">
      <input type="file" name="image" id="file" value="">
    </form>
    <img id="preview" width="100%" height="330px">
  </div>
  <div class="modal-footer">
    <button class="btn" id="close">Close</button>
    <button class="btn" name="submit" type="submit" form="form_id">Submit</button>
  </div>
</div>

{% endblock %}

{% block extra-js %}

  <script>

  function readURL(input) {
      if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function(e) {
              $('#preview').attr('src', e.target.result);
          }

          reader.readAsDataURL(input.files[0]);
      }
  }

  $("#file").change(function() {
      readURL(this);
  });

  var colors = ["3a5795", "279a29", "783a95", "dd3b38"]
  var randomColor = Math.floor(Math.random()*colors.length);

  $(".altogether").each(function() {
      $(this).find(".nextObjectW").css("border-color", "#" + colors[randomColor]);
      $(this).find(".containme").css("border-color", "#" + colors[randomColor]);
      $(this).find(".textpart").css("color", "#" + colors[randomColor]);
      $(this).find(".linkme").css("border-color", "#" + colors[randomColor]);
      $(this).find(".linkme").css("color", "#" + colors[randomColor]);
      randomColor = (randomColor + 1) % colors.length;
  });

  $(".textpart").hover(function() {
      if ($(this).css("color") == "rgb(58, 87, 149)") {
          $(this).toggleClass("bluest");
      }
      if ($(this).css("color") == "rgb(39, 154, 41)") {
          $(this).toggleClass("greenist");
      }
      if ($(this).css("color") == "rgb(120, 58, 149)") {
          $(this).toggleClass("purpleist");
      }
      if ($(this).css("color") == "rgb(221, 59, 56)") {
          $(this).toggleClass("reddist");
      }
  });

  {% for s in story %}
    
    $("#linkme{{s.id}}").hover(function() {
        $(this).removeClass("linkingpics");
        $(".formats").removeClass("linkpics");
        {% for w, i in snippet %}
            if ($("#photo{{w.links}}").attr("src") != "/media/") {
                $("#awesome{{i}}{{s.id}}").addClass("hoverpics");
            }
        {% endfor %}
        {% for word, index in snippet_large %}
            if ($("#photo{{word.links}}").attr("src") != "/media/") {
                $("#awesomer{{index}}{{s.id}}").addClass("hoverpics");
            }
        {% endfor %}
    });

    $("#linkme{{s.id}}").click(function() {
        $(this).addClass("linkingpics");
        $(".formats").removeClass("hoverpics");
        {% for w, i in snippet %}
            if ($("#photo{{w.links}}").attr("src") == "/media/") {
                $("#awesome{{i}}{{s.id}}").addClass("linkpics");
            }
        {% endfor %}
        {% for word, index in snippet_large %}
            if ($("#photo{{word.links}}").attr("src") == "/media/") {
                $("#awesomer{{index}}{{s.id}}").addClass("linkpics");
            }
        {% endfor %}
    });

    {% for w, i in snippet %}

        $("#awesome{{i}}{{s.id}}").click(function() {
            if ($("#awesome{{i}}{{s.id}}").hasClass("linkpics")) {
                $(".formats").removeClass("hoverpics");
                $('#myModal').fadeIn("slow");
                $("#form_id").attr("action", "/tag/{{s.id}}/{{w.links}}/");
            }
        });

        $("#awesome{{i}}{{s.id}}").mouseover(function() {
            if (!$("#linkme{{s.id}}").hasClass("linkingpics")) {
                if ($("#photo{{w.links}}").attr("src") != "/media/") {
                    $("#photo{{w.links}}").fadeTo("fast", 1);
                }
            }
        });

        $("#awesome{{i}}{{s.id}}").mouseout(function() {
            if (!$("#linkme{{s.id}}").hasClass("linkingpics")) {
                if ($("#photo{{w.links}}").attr("src") != "/media/") {
                    $("#photo{{w.links}}").fadeTo("fast", 0.5);
                }
            }
        });

        $("#photo{{w.links}}").mouseover(function() {
            if ($(this).attr("src") != "/media/") {
                $(this).fadeTo("fast", 1);
            }
        });

        $("#photo{{w.links}}").mouseout(function() {
            if ($(this).attr("src") != "/media/") {
                $(this).fadeTo("fast", 0.5);
            }
        });

    {% endfor %}

    {% for word, index in snippet_large %}

        $("#awesomer{{index}}{{s.id}}").click(function() {
            if ($("#awesomer{{index}}{{s.id}}").hasClass("linkpics")) {
                $(".formats").removeClass("hoverpics");
                $('#myModal').fadeIn("slow");
                $("#form_id").attr("action", "/tag/{{s.id}}/{{word.links}}/");
            }
        });

        $("#awesomer{{index}}{{s.id}}").mouseover(function() {
            if (!$("#linkme{{s.id}}").hasClass("linkingpics")) {
                if ($("#photo{{word.links}}").attr("src") != "/media/") {
                    $("#photo{{word.links}}").fadeTo("fast", 1);
                }
            }
        });

        $("#awesomer{{index}}{{s.id}}").mouseout(function() {
            if (!$("#linkme{{s.id}}").hasClass("linkingpics")) {
                if ($("#photo{{word.links}}").attr("src") != "/media/") {
                    $("#photo{{word.links}}").fadeTo("fast", 0.5);
                }
            }
        });

        $("#photo{{word.links}}").mouseover(function() {
            $(this).fadeTo("fast", 1);
        });

        $("#photo{{word.links}}").mouseout(function() {
            $(this).fadeTo("fast", 0.5);
        });

    {% endfor %}

  {% endfor %}

  $("#close_x").click(function() {
      $('#myModal').hide();
      $('#preview').attr('src', "");
      $("#file").val("");
  });

  $("#close").click(function() {
      $('#myModal').hide();
      $('#preview').attr('src', "");
      $("#file").val("");
  });

  $(document).mouseup(function(e) {

      var container = $("#myModal");

      if (!container.is(e.target) && container.has(e.target).length === 0) {

          container.hide();
          $('#preview').attr('src', "");
          $("#file").val("");

      }

  });

  </script>

{% endblock %}
